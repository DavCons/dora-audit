<script>
(function(){
  const EDGE_URL = "/api/request-magic-link";
  const APP_URL  = "http://51.21.152.197:8501";
  const email = document.getElementById('email');
  const btn   = document.getElementById('send');
  const msg   = document.getElementById('msg');
  btn.addEventListener('click', async ()=>{
    msg.textContent=""; msg.className="msg";
    const e=(email.value||"").trim();
    if(!e){ msg.textContent="Please enter your email."; msg.className="msg err"; return; }
    try{
      const res = await fetch(EDGE_URL, {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ email: e, redirect_to: APP_URL })
      });
      if(!res.ok){ const t=await res.text(); msg.textContent="Error: "+t; msg.className="msg err"; return; }
      msg.textContent="Magic link sent. Check your inbox."; msg.className="msg ok"; email.value="";
    }catch(err){ msg.textContent="Network error: "+(err?.message||err); msg.className="msg err"; }
  });
})();
</script>